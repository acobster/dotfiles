#!/usr/bin/env bash

usage() {
  echo "usage: $(basename $0) [-h|--help]"
  echo
  echo 'Keep is a tool for keeping or removing files from an arbitrary list,'
  echo 'interactively. It takes zero or more lines from STDIN and for each one'
  echo 'prompts the user to choose whether to keep (the default) or remove'
  echo 'that file.'
  echo
  echo '  EXAMPLE:'
  echo
  echo '  $ ls | keep'
  echo
  echo '  OPTIONS:'
  echo
  echo '  -h|--help show this help text'
}

POSITIONAL=()
while [[ $# -gt 0 ]]
do
key="$1"

case $key in
    -h|--help)
    # show usage and bail
    usage
    exit
    ;;
    -d|--dry-run)
    DRY_RUN=1
    shift # past argument
    ;;
    -y|--arg-with-value)
    VALARG="$2"
    shift # past argument
    shift # past value
    ;;
    *)
    POSITIONAL+=("$1") # save it in an array for later
    shift # past argument
    ;;
esac

done
set -- "${POSITIONAL[@]}" # restore positional parameters


opts='-rf' # TODO
while read file; do
  read -p "Keep $file (Y/n)? [Ctrl+C to quit] " choice < /dev/tty
  if [[ $choice == 'n' ]] ; then
    if [[ $DRY_RUN ]] ; then
      echo rm $opts $cmd
    else
      rm $opts "$file"
    fi
  else
    echo "kept $file."
  fi
done < /dev/stdin
